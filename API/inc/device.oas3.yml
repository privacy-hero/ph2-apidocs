###### HEADER INFO ##################
openapi: "3.0.2"
info:
  title: "Privacy Hero 2 - Mothership API - Components Specification"
  version: "1.0"
  description: |-
    The complete backend API for the Privacy Hero 2.

    The backend server infrastructure is known as the *"Mothership"*
  license:
    name: Copyright Â© 2020 HelpOn Inc. All Rights Reserved
  contact:
    name: API Support
    url: http://www.example.com/support
    email: support@example.com

paths:
  /silence-lint:
    get:
      operationId: silenceLint
      description: dummy response to silence lint errors in this file
      tags:
        - Schema Definitions
      responses:
        "200":
          description: dummy response to silence lint errors in this file
          content:
              application/json:
                schema:
                  oneOf:
                    - $ref: "#/components/schemas/Device"
                    - $ref: "#/components/schemas/Devices"
                    - $ref: "#/components/schemas/DeviceUsageHistory"
                    - $ref: "#/components/schemas/Device-Settings"
                    - $ref: "#/components/schemas/Device-Settings-Reply"

###### THE SERVERS WHERE THIS API CAN BE USED ############
servers:
  - url: https://{awsid}.execute-api.us-east-1.amazonaws.com/dev
    description: Development URL
    variables:
      awsid:
        default: "999999"
        description: The ID for your dev AWS deployment

tags:
  - name: Schema Definitions
    description: These are all schema definitions.

#########################################################
# Components are preformatted data that can be reused in definitions.
components:

  schemas:

    DeviceIP:
      type: object
      required:
        - ip4
      additionalProperties: false
      properties:
        ip4:
          $ref: "./simpletypes.oas3.yml#/components/schemas/ip4"
        ip6:
          $ref: "./simpletypes.oas3.yml#/components/schemas/ip6"

    DeviceConfig:
      type: object
      required:
        - vpn
        - device-protection
        - ad-blocking
      additionalProperties: false
      description: |-
        - **vpn**: Enabled or Not.
        - **Ad-blocking**: Enabled or Not.
        - **device-protection**: Enabled or not.
      properties:
        vpn:
          $ref: "./adapter.oas3.yml#/components/schemas/state"
        ad-blocking:
          $ref: "./adapter.oas3.yml#/components/schemas/state"
        device-protection:
          $ref: "./adapter.oas3.yml#/components/schemas/state"

    DeviceUsageRecord:
      type: object
      description: |-
        - **timestamp**: The start of the period.
        - **tx**: Number of bytes sent by the device in the period.
        - **rx**: Number of bytes received by the device in the period.
      required:
        - timestamp
        - tx
        - rx
      additionalProperties: false
      properties:
        timestamp:
          $ref: "./simpletypes.oas3.yml#/components/schemas/epoch-timestamp"
        tx:
          $ref: "./simpletypes.oas3.yml#/components/schemas/datausage"
        rx:
          $ref: "./simpletypes.oas3.yml#/components/schemas/datausage"

    DeviceUsageHistory:
      type: array
      description: |-
        Holds up to 90 days worth of hourly data usage records for the device.
        The resolution of the items (daily or hourly) depends on the api call.
      minItems: 1
      maxItems: 2160
      items:
        $ref: "#/components/schemas/DeviceUsageRecord"

    #DeviceUsageSummary:
    #  type: object
    #  description: |-
    #    Holds a summary of the devices usage.
    #    - **hours24**: The last 24 hour aggregated usage.
    #    - **week**: The last 7 days aggregated usage.
    #    - **month**: The last 30 days aggregated usage.
    #    - **quarter**: The last 90 days aggregated usage.
    #
    #    **timestamp** in the device usage is the start of the period in question.
    #  additionalProperties: false
    #  properties:
    #    hours24:
    #      $ref: "#/components/schemas/DeviceUsageRecord"
    #    week:
    #      $ref: "#/components/schemas/DeviceUsageRecord"
    #    month:
    #      $ref: "#/components/schemas/DeviceUsageRecord"
    #    quarter:
    #      $ref: "#/components/schemas/DeviceUsageRecord"


    Device:
      type: object
      required:
        - id
        - adapter
        - profile
        - mac
      additionalProperties: false
      properties:
        id:
          $ref: "./simpletypes.oas3.yml#/components/schemas/uuid"
        adapter:
          $ref: "./simpletypes.oas3.yml#/components/schemas/uuid"
        profile:
          $ref: "./simpletypes.oas3.yml#/components/schemas/uuid"
        mac:
          $ref: "./simpletypes.oas3.yml#/components/schemas/mac"
        name:
          $ref: "./simpletypes.oas3.yml#/components/schemas/device-name"
        type:
          $ref: "./simpletypes.oas3.yml#/components/schemas/device-name"
        manufacturer:
          $ref: "./simpletypes.oas3.yml#/components/schemas/device-name"
        ip:
          $ref: "#/components/schemas/DeviceIP"
        online:
          type: boolean
          default: true
        online_since:
          $ref: "./simpletypes.oas3.yml#/components/schemas/epoch-timestamp"
        discovered:
          $ref: "./simpletypes.oas3.yml#/components/schemas/epoch-timestamp"
        cfg:
          $ref: "#/components/schemas/DeviceConfig"
      example: {
        "id": "e22cfd99-44e5-4c93-8cad-3185c623cc25",
        "adapter": "cd73b915-89a4-4971-9d86-bce91786b12a",
        "profile": "66f7346a-48af-4614-bd7b-6c17093d75e3",
        "mac": "00-00-5E-DF-98-EB",
        "name": "Nokia N78",
        "type": "Smartphone",
        "manufacturer": "Nokia",
        "ip": {
          "ip4": "192.168.0.55",
          "ip6": "2001:db8:85a3::8a2e:370:7334"
        },
        "online": true,
        "online_since": 1587732975,
        "discovered": 1587732975,
        "cfg": {
          "vpn": {
            "state": false,
            "since": 1587732975
          },
          "ad-blocking": {
            "state": false,
            "since": 1587732975
          },
          "device-protection": {
            "state": false,
            "since": 1587732975
          }
        },
      }


    Devices:
      description: An array of known devices
      type: array
      minItems: 0
      maxItems: 512
      items:
        $ref: "#/components/schemas/Device"

    Device-Settings:
      type: object
      additionalProperties: false
      properties:
        settings:
          type: object
          description: |-
            The response to setting a device configuration.
            - **current-state** The services current state.
            - **current-tstamp** The time the current state became set on the
            Adapter.
            - **request-tstamp** The requested state becomes valid when its
            "current-tstamp" value equals or exceeds the returned **request-tstamp**
          required:
            - current-state
            - current-tstamp
            - request-tstamp
          additionalProperties: false
          properties:
            current-state:
              type: boolean
              description: |-
                The current state of the requested service.
            current-tstamp:
              $ref: "./simpletypes.oas3.yml#/components/schemas/epoch-timestamp-nonull"
            request-tstamp:
              $ref: "./simpletypes.oas3.yml#/components/schemas/epoch-timestamp-nonull"
          example:
            current-state: False
            current-tstamp: 1589978803
            request-tstamp: 1590583603


    Device-Settings-Reply:
      type: object
      additionalProperties: false
      description: |-
        The response to setting an device service setting.
        - **current-state** The services current state.
        - **current-tstamp** The time the current state became set for the device.
        - **request-tstamp** The requested state becomes valid when its
        "current-tstamp" value equals or exceeds the returned **request-tstamp**
      required:
        - current-state
        - current-tstamp
        - request-tstamp
      properties:
        current-state:
          type: boolean
          description: |-
            The current state of the requested service.
        current-tstamp:
          $ref: "./simpletypes.oas3.yml#/components/schemas/epoch-timestamp-nonull"
        request-tstamp:
          $ref: "./simpletypes.oas3.yml#/components/schemas/epoch-timestamp-nonull"
      example:
        current-state: False
        current-tstamp: 1589978803
        request-tstamp: 1590583603
